<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Browser-Only AI Menu (Case-1)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #020617;
  color: #e5e7eb;
  padding: 20px;
}
h2 { margin-bottom: 6px; }
input, button {
  padding: 10px;
  font-size: 16px;
}
button { cursor: pointer; }
#state { margin-top: 10px; font-weight: bold; }
pre {
  background: #020617;
  border: 1px solid #1e293b;
  padding: 10px;
  margin-top: 10px;
  max-height: 260px;
  overflow-y: auto;
  font-size: 13px;
}
.ok { color: #22c55e; }
.fail { color: #ef4444; }
.menu-item {
  padding: 8px;
  border-bottom: 1px solid #1e293b;
}
</style>
</head>

<body>

<h2>üçΩÔ∏è AI Menu (Browser-Only)</h2>
<p><b>Model:</b> Xenova/distilgpt2 (intent parsing only)</p>

<input id="userInput" placeholder="e.g. show veg spicy items" size="35"/>
<button id="sendBtn">Ask</button>

<div id="state">Idle</div>
<pre id="log"></pre>

<h3>Menu</h3>
<div id="menu"></div>

<script type="module">
/* ============================================================
   MENU DATA (DETERMINISTIC)
============================================================ */
const MENU = [
  { name: "Paneer Pizza", veg: true, spicy: false, price: 250 },
  { name: "Veg Burger", veg: true, spicy: false, price: 120 },
  { name: "Spicy Fries", veg: true, spicy: true, price: 100 },
  { name: "Chicken Pizza", veg: false, spicy: true, price: 300 },
  { name: "Coke", veg: true, spicy: false, price: 60 }
];

/* ============================================================
   UI HELPERS
============================================================ */
const stateBox = document.getElementById("state");
const logBox = document.getElementById("log");
const menuBox = document.getElementById("menu");

function state(msg, cls="") {
  stateBox.textContent = msg;
  stateBox.className = cls;
  log("STATE ‚Üí " + msg);
}
function log(msg) {
  logBox.textContent += msg + "\n";
  logBox.scrollTop = logBox.scrollHeight;
}
function renderMenu(items) {
  menuBox.innerHTML = "";
  if (items.length === 0) {
    menuBox.innerHTML = "<p>No items match.</p>";
    return;
  }
  items.forEach(i => {
    menuBox.innerHTML +=
      `<div class="menu-item">${i.name} ‚Äì ‚Çπ${i.price}</div>`;
  });
}

/* ============================================================
   LOAD MENU INITIALLY
============================================================ */
renderMenu(MENU);

/* ============================================================
   LOAD LLM
============================================================ */
state("Loading LLM‚Ä¶");

const { pipeline, env } =
  await import("https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2");

env.allowLocalModels = false;
env.useBrowserCache = true;

const llm = await pipeline(
  "text-generation",
  "Xenova/distilgpt2",
  { device: "cpu" }
);

state("‚úÖ LLM Ready", "ok");

/* ============================================================
   SIMPLE INTENT PARSER (LLM ‚Üí TEXT ‚Üí RULES)
============================================================ */
function parseIntent(text) {
  text = text.toLowerCase();
  return {
    veg: text.includes("veg"),
    spicy: text.includes("spicy"),
    cheap: text.includes("cheap") || text.includes("low price")
  };
}

/* ============================================================
   HANDLE USER QUERY
============================================================ */
document.getElementById("sendBtn").onclick = async () => {
  const query = document.getElementById("userInput").value;
  if (!query) return;

  state("Understanding request‚Ä¶");

  const prompt = `
User request: "${query}"
Extract keywords like veg, spicy, cheap.
Keywords:
`;

  const out = await llm(prompt, {
    max_new_tokens: 40,
    temperature: 0.1
  });

  log("LLM RAW OUTPUT:");
  log(out[0].generated_text);

  const intent = parseIntent(out[0].generated_text);

  let filtered = MENU;

  if (intent.veg) filtered = filtered.filter(i => i.veg);
  if (intent.spicy) filtered = filtered.filter(i => i.spicy);
  if (intent.cheap) filtered = filtered.filter(i => i.price <= 150);

  renderMenu(filtered);
  state("‚úÖ Menu updated", "ok");
};
</script>

</body>
</html>
