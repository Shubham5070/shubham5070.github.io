<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Case-1 FINAL PROOF ‚Äì Browser-Only LLM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #020617;
  color: #e5e7eb;
  padding: 20px;
}
button {
  padding: 12px 18px;
  font-size: 16px;
  cursor: pointer;
}
#state {
  margin-top: 12px;
  font-weight: bold;
}
pre {
  background: #020617;
  border: 1px solid #1e293b;
  padding: 10px;
  margin-top: 15px;
  max-height: 320px;
  overflow-y: auto;
  font-size: 13px;
}
.fail {
  color: #ef4444;
}
.ok {
  color: #22c55e;
}
</style>
</head>

<body>

<h2>üß™ Case-1: Browser-Only LLM (FINAL PROOF)</h2>

<button id="btn">Load Local LLM</button>

<div id="state">Idle</div>
<pre id="log"></pre>

<script type="module">
const logBox = document.getElementById("log");
const stateBox = document.getElementById("state");
const btn = document.getElementById("btn");

function log(msg) {
  logBox.textContent += msg + "\n";
  logBox.scrollTop = logBox.scrollHeight;
}
function state(msg, cls="") {
  stateBox.textContent = msg;
  stateBox.className = cls;
  log("STATE ‚Üí " + msg);
}

/* ---------- GLOBAL ERROR TRAPS ---------- */
window.onerror = (msg) => {
  state("JS Runtime Error", "fail");
  log("window.onerror ‚Üí " + msg);
};
window.onunhandledrejection = (e) => {
  state("Unhandled Promise Rejection", "fail");
  log("unhandledrejection ‚Üí " + e.reason);
};

/* ---------- HEARTBEAT ---------- */
let hb;
function startHB() {
  let n = 0;
  hb = setInterval(() => log("Heartbeat " + (++n)), 500);
}
function stopHB() {
  clearInterval(hb);
}

btn.onclick = async () => {
  btn.disabled = true;
  state("Button clicked");
  log("Click registered");
  startHB();

  try {
    await new Promise(r => setTimeout(r, 100));

    state("Importing Transformers.js‚Ä¶");
    const { pipeline, env } =
      await import("https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2");

    state("Transformers imported");

    /* ---------- DEFENSIVE BACKEND CONFIG ---------- */
    log("Configuring backends safely‚Ä¶");

    env.allowLocalModels = false;
    env.useBrowserCache = true;

    if (env.backends?.webgpu) {
      env.backends.webgpu.enabled = false;
      log("WebGPU disabled");
    } else {
      log("WebGPU backend not present");
    }

    if (env.backends?.wasm) {
      env.backends.wasm.enabled = true;
      log("WASM enabled");
    } else {
      log("WASM backend not present");
    }

    if (env.backends?.onnx?.wasm) {
      env.backends.onnx.wasm.numThreads = 1;
      log("ONNX WASM threads set to 1");
    }

    await new Promise(r => setTimeout(r, 100));

    state("Creating pipeline‚Ä¶");
    
    const generator = await pipeline(
      "text-generation",
      "Xenova/distilgpt2",
      { device: "cpu" }
    );


    stopHB();
    state("‚úÖ Model Loaded", "ok");

    log("Running inference‚Ä¶");
    const out = await generator("Hello", { max_new_tokens: 8 });
    log("Output ‚Üí " + JSON.stringify(out));

    state("üéâ Case-1 WORKED (rare)", "ok");

  } catch (e) {
    stopHB();
    state("‚ùå Failed", "fail");
    log("Caught Error ‚Üí " + (e.message || e));
  } finally {
    btn.disabled = false;
  }
};
</script>


</body>
</html>


